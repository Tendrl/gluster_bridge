---
tendrl_schema_version: 0.1

valid_objects:
- tendrl_context
- volume
- brick
- peer

object_details:
  tendrl_context:
    enabled: True
    value: /clusters/$cluster.id/tendrl_context
    attrs:
      sds_type:
        type: String
        help: "gluster-3.8.3"
  volume:
    enabled: True
    value: "/clusters/$cluster.id/volumes/$volume.id"
    attrs:
      volname:
        type: String
        help: "Name of gluster volume"
      stripe_count:
        type: Integer
        help: "Stripe count of volume"
      replica_count:
        type: Integer
        help: "Replica count of volume"
      disperse_count:
        type: Integer
        help: "Disperse count of volume"
      redundancy_count:
        type: Integer
        help: "Redundancy count of volume"
      transport:
        type: String
        help: "Transport type for volume"
      brickdetails:
        type: brick[]
        help: "List of bricks for volume"
      force:
        type: Boolean
        help: "If force execute the action"

    atoms:
        create:
          enabled: True
          uuid: "242f6190-9b37-11e6-950d-a24fc0d9649c"
          flows: ["CreateVolume"]
          run: "tendrl.gluster_bridge.atoms.volume.create.Create"
          type: "create"
          pre_run : []
          post_run: []
          name: "create_volume"
          outputs:
            - "volname"
          inputs:
            - "volname"
            - ["stripe_count"]
            - ["replica_count"]
            - ["disperse_count"]
            - ["redundancy_count"]
            - ["transport"]
            - "brickdetails"
            - ["force"]
          version: "0.1.0"
        delete:
          enabled: True
          uuid: "538da518-9b38-11e6-9f33-a24fc0d9649c"
          flows: ["DeleteVolume"]
          run: "tendrl.gluster_bridge.atoms.volume.delete.Delete"
          type: "delete"
          pre_run: []
          post_run: []
          name: "delete_volume"
          outputs:
            - "success"
          inputs:
            - "volname"
          version: "0.1.0"
        start:
          enabled: True
          uuid: "873bf2a2-9b38-11e6-9f33-a24fc0d9649c"
          flows: ["StartVolume"]
          run: "tendrl.gluster_bridge.atoms.volume.start.Start"
          type: "action"
          pre_run: []
          post_run: []
          name: "start_volume"
          outputs:
            - "success"
          inputs:
            - "volname"
          version: "0.1.0"
        stop:
          enabled: True
          uuid: "aa92dae0-9b38-11e6-9f33-a24fc0d9649c"
          flows: ["StopVolume"]
          run: "tendrl.gluster_bridge.atoms.volume.stop.Stop"
          type: "action"
          pre_run: []
          post_run: []
          name: "stop_volume"
          outputs:
            - "success"
          inputs:
            - "volname"
          version: "0.1.0"
        set:
          enabled: True
          uuid: "d9388930-9b38-11e6-9f33-a24fc0d9649c"
          flows: ["SetVolumeOptions"]
          run: "tendrl.gluster_bridge.atoms.volume.set.Set"
          type: "update"
          pre_run: []
          post_run: []
          name: "set_volume_options"
          outputs:
            - "success"
          inputs:
            - "volname"
            - "option_name"
            - "option_value"
          version: "0.1.0"
        add_brick:
          enabled: True
          uuid: "42690bb4-9b39-11e6-9f33-a24fc0d9649c"
          flows: ["AddBrick"]
          run: "tendrl.gluster_bridge.atoms.volume.add_brick.AddBrick"
          type: "action"
          pre_run: []
          post_condition: []
          name: "add_brick"
          outputs:
            - "success"
          inputs:
            - "volname"
            - "brickdetails"
          version: "0.1.0"
        remove_brick_start:
          enabled: True
          uuid: "a07076ca-9b39-11e6-9f33-a24fc0d9649c"
          flows: ["RemoveBrickStart"]
          run: "tendrl.gluster_bridge.atoms.volume.remove_brick_start.RemoveBrickStart"
          type: "action"
          pre_run: []
          post_run: []
          name: "remove_brick_start"
          outputs:
            - "success"
          inputs:
            - "volname"
            - "brick_name"
          version: "0.1.0"
        remove_brick_stop:
          enabled: True
          uuid: "ee5433c8-9b42-11e6-9f33-a24fc0d9649c"
          flows: ["RemoveBrickStop"]
          run: "tendrl.gluster_bridge.atoms.volume.remove_brick_stop.RemoveBrickStop"
          type: "action"
          pre_run: []
          post_run: []
          name: "remove_brick_stop"
          outputs:
            - "success"
          inputs:
            - "volname"
            - "brick_name"
          version: "0.1.0"
        remove_brick_commit:
          enabled: True
          uuid: "d7b02c70-9b39-11e6-9f33-a24fc0d9649c"
          flows: ["RemoveBrickCommit"]
          run: "tendrl.gluster_bridge.atoms.volume.remove_brick_commit.RemoveBrickCommit"
          type: "action"
          pre_run: []
          post_run: []
          name: "remove_brick_commit"
          outputs:
            - "success"
          inputs:
            - "volname"
            - "brick_name"
          version: "0.1.0"
        replace_brick_commit:
          enabled: True
          uuid: "2e7a017a-9b3a-11e6-9f33-a24fc0d9649c"
          flows: ["ReplaceBrickCommit"]
          run: "tendrl.gluster_bridge.atoms.volume.replace_brick_start.ReplaceBrickCommit"
          type: "action"
          pre_run: []
          post_run: []
          name: "replace_brick_commit"
          outputs:
            - "success"
          inputs:
            - "volname"
            - "source_brick"
            - "destination_brick"
          version: "0.1.0"
        rebalance_start:
          enabled: True
          uuid: "85c82b82-9b3a-11e6-9f33-a24fc0d9649c"
          flows: ["RebalanceStart"]
          run: "tendrl.gluster_bridge.atoms.volume.rebalance_start.RebalanceStart"
          type: "action"
          pre_run: []
          post_run: []
          name: "rebalance_start"
          outputs:
            - "success"
          inputs:
            - "volname"
            - ["fix_layout"]
            - ["force"]
          version: "0.1.0"
        rebalance_stop:
          enabled: True
          uuid: "b1646aa8-9b3a-11e6-9f33-a24fc0d9649c"
          flows: ["RebalanceStop"]
          run: "tendrl.gluster_bridge.atoms.volume.rebalance_stop.RebalanceStop"
          type: "action"
          pre_run: []
          post_run: []
          name: "rebalance_stop"
          outputs:
            - "node"
            - "rebalanced_files"
            - "size"
            - "scanned_files"
            - "status"
          inputs:
            - "volname"
          version: "0.1.0"
        log_rotate:
          enabled: True
          uuid: "a468ecba-9b3b-11e6-9f33-a24fc0d9649c"
          flows: ["LogRotate"]
          run: "tendrl.gluster_bridge.atoms.volume.log_rotate.LogRotate"
          type: "action"
          pre_run: []
          post_run: []
          name: "log_rotate"
          outputs:
            - "success"
          inputs:
            - "volname"
          version: "0.1.0"
  brick:
    enabled: True
    value: "/clusters/$cluster.id/volumes/$volume.id/bricks/$brick.id"
    attrs:
      brickdetails:
        type: String
        help: "Details of the brick"
      volname:
        type: String
        help: "Gluster volume name"

  peer:
    enabled: True
    value: "/clusters/$cluster.id/hosts/$host.id"
    attrs:
      hostname:
        type: String
        help: "FQDN name of the host"

    atoms:
      probe:
        enabled: True
        uuid: "84806420-9b43-11e6-9f33-a24fc0d9649c"
        flows: ["PeerProbe"]
        run: "tendrl.gluster_bridge.atoms.peer.probe.Probe"
        type: "action"
        pre_run: []
        post_run: []
        name: "peer_probe"
        outputs:
          - "success"
        inputs:
          - "peer"
        version: "0.1.0"
      detach:
        enabled: True
        uuid: "ade307d2-9b43-11e6-9f33-a24fc0d9649c"
        flows: ["PeerDetach"]
        run: "tendrl.gluster_bridge.atoms.peer.detach.Detach"
        type: "action"
        pre_run: []
        post_run: []
        name: "detach"
        outputs:
          - "success"
        inputs:
          - "peer"
        version: "0.1.0"

  flows:
    CreateVolume:
      enabled: True
      tendrl_context: "$cluster.id"
      uuid: "1951e821-7aa9-4a91-8183-e73bc8275b8e"
      description: "Create Volume with pre-existing bricks"
      atoms: ["volume.create"]
      pre_run : []
      post_run: []
      run: "tendrl.gluster_bridge.flows.create_volume.CreateVolume"
      type: Create
      outputs:
        - "volname"
      inputs:
        - "volname"
        - ["stripe_count"]
        - ["replica_count"]
        - ["disperse_count"]
        - ["redundancy_count"]
        - ["transport"]
        - "brickdetails"
        - ["force"]
      version: "0.1.0"

    DeleteVolume:
      enabled: True
      tendrl_context: "$volume.id"
      uuid: "91a8b656-903b-11e6-ae22-56b6b6499611"
      description: "Delete an existing volume"
      atoms: ["volume.delete"]
      pre_run: []
      post_run: []
      run: "tendrl.gluster_bridge.flows.delete_volume.DeleteVolume"
      type: Delete
      outputs:
        - "success"
      inputs:
        - "volname"
      version: "0.1.0"

    StartVolume:
      enabled: True
      tendrl_context: "$volume.id"
      uuid: "e5429376-903c-11e6-ae22-56b6b6499611"
      description: "Start a volume"
      atoms: ["volume.start"]
      pre_run: []
      post_run: []
      run: "tendrl.gluster_bridge.flows.start_volume.StartVolume"
      type: Start
      outputs:
        - "success"
      inputs:
        - "volname"
      version: "0.1.0"

    StopVolume:
      enabled: True
      tendrl_context: "$volume.id"
      uuid: "cc4661e2-9044-11e6-ae22-56b6b6499611"
      description: "Stop a volume"
      atoms: ["volume.stop"]
      pre_run: []
      post_run: []
      run: "tendrl.gluster_bridge.flows.stop_volume.StopVolume"
      type: Stop
      outputs:
        - "success"
      inputs:
        - "volname"
      version: "0.1.0"

    SetVolumeOptions:
      enabled: True
      tendrl_context: "$volume.id"
      uuid: "5a433fd8-9045-11e6-ae22-56b6b6499611"
      description: "Set a volume option"
      atoms: ["volume.set"]
      pre_run: []
      post_run: []
      run: "tendrl.gluster_bridge.flows.set_volume_option.SetVolumeOption"
      type: SetVolumeOption
      outputs:
        - "success"
      inputs:
        - "volname"
        - "option_name"
        - "option_value"
      version: "0.1.0"

    AddBrick:
      enabled: True
      tendrl_context: "$volume.id"
      uuid: "c416a35e-9046-11e6-ae22-56b6b6499611"
      description: "Add a brick to the volume"
      atoms: ["volume.add_brick"]
      pre_run: []
      post_run: []
      run: "tendrl.gluster_bridge.flows.add_volume_brick.AddVolumeBrick"
      type: AddBrick
      outputs:
        - "success"
      inputs:
        - "volname"
        - "brickdetails"
      version: "0.1.0"

    RemoveBrickStart:
      enabled: True
      tendrl_context: "$brick.id"
      uuid: "80375772-9047-11e6-ae22-56b6b6499611"
      description: "Start a remove brick on volume"
      atoms: ["volume.remove_brick_start"]
      pre_run: []
      post_run: []
      run: "tendrl.gluster_bridge.flows.volume_remove_brick_start.VolumeRemoveBrickStart"
      type: RemoveBrickStart
      outputs:
        - "success"
      inputs:
        - "volname"
        - "brick_name"
      version: "0.1.0"

    RemoveBrickCommit:
      enabled: True
      tendrl_context: "$brick.id"
      uuid: "8a01cbbc-904b-11e6-ae22-56b6b6499611"
      description: "Commit a remove brick task on volume"
      atoms: ["volume.remove_brick_commit"]
      pre_run: []
      post_run: []
      run: "tendrl.gluster_bridge.flows.volume_remove_brick_commit.VolumeRemoveBrickCommit"
      type: RemoveBrickCommit
      outputs:
        - "success"
      inputs:
        - "volname"
        - "brick_name"
      version: "0.1.0"

    ReplaceBrickCommit:
      enabled: True
      tendrl_context: "$brick.id"
      uuid: "2dd06e6a-904c-11e6-ae22-56b6b6499611"
      description: "Commit a replace brick on volume"
      atoms: ["volume.replace_brick_start"]
      pre_run: []
      post_run: []
      run: "tendrl.gluster_bridge.flows.volume_replace_brick_commit.VolumeReplaceBrickCommit"
      type: ReplaceBrickCommit
      outputs:
        - "success"
      inputs:
        - "volname"
        - "source_brick"
        - "destination_brick"
      version: "0.1.0"

    RebalanceStart:
      enabled: True
      tendrl_context: "$volume.id"
      uuid: "c0a87812-905c-11e6-ae22-56b6b6499611"
      description: "Starts a rebalance of volume"
      atoms: ["volume.rebalance_start"]
      pre_run: []
      post_run: []
      run: "tendrl.gluster_bridge.flows.volume_rebalance_start.VolumeRebalanceStart"
      type: RebalanceStart
      outputs:
        - "success"
      inputs:
        - "volname"
        - ["fix_layout"]
        - ["force"]
      version: "0.1.0"

    RebalanceStop:
      enabled: True
      tendrl_context: "$volume.id"
      uuid: "17481172-905e-11e6-ae22-56b6b6499611"
      description: "Stops a rebalance of volume"
      atoms: ["volume.rebalance_stop"]
      pre_run: []
      post_run: []
      run: "tendrl.gluster_bridge.flows.volume_rebalance_stop.VolumeRebalanceStop"
      type: RebalanceStop
      outputs:
        - "node"
        - "rebalanced_files"
        - "size"
        - "scanned_files"
        - "status"
      inputs:
        - "volname"
      version: "0.1.0"

    LogRotate:
      enabled: True
      tendrl_context: "$volume.id"
      uuid: "c53e8ffe-905e-11e6-ae22-56b6b6499611"
      description: "Rotates the logs for volume"
      atoms: ["volume.log_rotate"]
      pre_run: []
      post_run: []
      run: "tendrl.gluster_bridge.flows.volume_log_rotate.VolumeLogRotate"
      type: LogRotate
      outputs:
        - "success"
      inputs:
        - "volname"
      version: "0.1.0"

    PeerProbe:
      enabled: True
      tendrl_context: "$cluster.id"
      uuid: "73421b1e-943a-11e6-ae22-56b6b6499611"
      description: "Peer probes a new node"
      atoms: ["peer.probe"]
      pre_run: []
      post_run: []
      run: "tendrl.gluster_bridge.flows.peer_probe.PeerProbe"
      type: PeerProbe
      outputs:
        - "success"
      inputs:
        - "peer"
      version: "0.1.0"

    PeerDetach:
      enabled: True
      tendrl_context: "$host.id"
      uuid: "f57f6f20-9447-11e6-ae22-56b6b6499611"
      description: "Detaches a node from cluster"
      atoms: ["peer.detach"]
      pre_run: []
      post_run: []
      run: "tendrl.gluster_bridge.flows.peer_detach.PeerDetach"
      type: PeerDetach
      outputs:
        - "success"
      inputs:
        - "peer"
      version: "0.1.0"
